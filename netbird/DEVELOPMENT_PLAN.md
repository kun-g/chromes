# PyNetBird å¼€å‘è®¡åˆ’

## å¼€å‘ç­–ç•¥
åŸºäºç°æœ‰ manage_groups.py çš„å®ç°ç»éªŒï¼Œå°†å…¶é‡æ„ä¸ºå®Œæ•´çš„ Python åŒ…ã€‚é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºå¹¶è¡Œå¼€å‘ã€‚

## å½“å‰çŠ¶æ€
- âœ… å·²æœ‰å·¥ä½œçš„ NetBird API é›†æˆä»£ç 
- âœ… äº†è§£äº†æ­£ç¡®çš„ API è®¤è¯æ–¹å¼ (Token vs Bearer)
- âœ… ä¿®å¤äº† API å“åº”ç»“æ„è§£æé—®é¢˜
- âœ… é…ç½®äº† uv ä¾èµ–ç®¡ç†

## å¹¶è¡Œå¼€å‘ä»»åŠ¡åˆ†è§£

### Task 1: åŸºç¡€æ¶æ„ ğŸ—ï¸
**é¢„ä¼°æ—¶é—´**: 1-2 å°æ—¶
**æ–‡ä»¶æ¸…å•**:
```
pynetbird/
â”œâ”€â”€ base.py           # HTTP é€šä¿¡åŸºç¡€ç±»
â”œâ”€â”€ exceptions.py     # å¼‚å¸¸å®šä¹‰
â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†
â””â”€â”€ utils.py         # å·¥å…·å‡½æ•°
```

**æ ¸å¿ƒåŠŸèƒ½**:
- HTTP å®¢æˆ·ç«¯å°è£… (åŸºäº httpx)
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- é…ç½®åŠ è½½ (ç¯å¢ƒå˜é‡/æ–‡ä»¶/å‚æ•°)
- å“åº”æ•°æ®é¢„å¤„ç†

### Task 2: æ•°æ®æ¨¡å‹ ğŸ“‹
**é¢„ä¼°æ—¶é—´**: 2-3 å°æ—¶
**æ–‡ä»¶æ¸…å•**:
```
models/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ base.py          # åŸºç¡€æ¨¡å‹ç±»
â”œâ”€â”€ peer.py         # Peer æ•°æ®æ¨¡å‹
â”œâ”€â”€ group.py        # Group æ•°æ®æ¨¡å‹
â””â”€â”€ policy.py       # Policy æ•°æ®æ¨¡å‹
```

**æ ¸å¿ƒåŠŸèƒ½**:
- Pydantic æ¨¡å‹å®šä¹‰
- æ•°æ®éªŒè¯å’Œç±»å‹æ£€æŸ¥
- åºåˆ—åŒ–/ååºåˆ—åŒ–
- æ¨¡å‹ä¹‹é—´çš„å…³ç³»å¤„ç†

### Task 3: èµ„æºç®¡ç†å™¨ ğŸ”§
**é¢„ä¼°æ—¶é—´**: 3-4 å°æ—¶
**æ–‡ä»¶æ¸…å•**:
```
managers/
â”œâ”€â”€ base.py         # åŸºç¡€ç®¡ç†å™¨
â”œâ”€â”€ peers.py        # Peers ç®¡ç†
â”œâ”€â”€ groups.py       # Groups ç®¡ç†
â””â”€â”€ policies.py     # Policies ç®¡ç†
```

**æ ¸å¿ƒåŠŸèƒ½**:
- CRUD æ“ä½œå®ç°
- æ‰¹é‡æ“ä½œæ”¯æŒ
- å‚æ•°éªŒè¯
- é”™è¯¯å¤„ç†

### Task 4: å®¢æˆ·ç«¯å°è£… ğŸ¯
**é¢„ä¼°æ—¶é—´**: 1-2 å°æ—¶
**æ–‡ä»¶æ¸…å•**:
```
â”œâ”€â”€ client.py           # åŒæ­¥å®¢æˆ·ç«¯
â”œâ”€â”€ async_client.py     # å¼‚æ­¥å®¢æˆ·ç«¯
â””â”€â”€ __init__.py        # åŒ…å…¥å£
```

**æ ¸å¿ƒåŠŸèƒ½**:
- å®¢æˆ·ç«¯åˆå§‹åŒ–
- ç®¡ç†å™¨é›†æˆ
- åŒæ­¥/å¼‚æ­¥æ¥å£ç»Ÿä¸€

### Task 5: CLI å·¥å…· ğŸ’»
**é¢„ä¼°æ—¶é—´**: 3-4 å°æ—¶
**æ–‡ä»¶æ¸…å•**:
```
cli/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ main.py            # CLI å…¥å£
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ peers.py      # peers å‘½ä»¤
â”‚   â”œâ”€â”€ groups.py     # groups å‘½ä»¤
â”‚   â”œâ”€â”€ policies.py   # policies å‘½ä»¤
â”‚   â””â”€â”€ config.py     # config å‘½ä»¤
â””â”€â”€ formatters.py     # è¾“å‡ºæ ¼å¼åŒ–
```

**æ ¸å¿ƒåŠŸèƒ½**:
- Click å‘½ä»¤è¡Œæ¡†æ¶
- å¤šç§è¾“å‡ºæ ¼å¼ (table/json/yaml)
- é…ç½®ç®¡ç†å‘½ä»¤
- å¸®åŠ©æ–‡æ¡£

### Task 6: æµ‹è¯•å’Œæ–‡æ¡£ ğŸ§ª
**é¢„ä¼°æ—¶é—´**: 2-3 å°æ—¶
**æ–‡ä»¶æ¸…å•**:
```
tests/
â”œâ”€â”€ test_models.py
â”œâ”€â”€ test_managers.py
â”œâ”€â”€ test_client.py
â””â”€â”€ test_cli.py
examples/
â”œâ”€â”€ basic_usage.py
â”œâ”€â”€ async_usage.py
â””â”€â”€ cli_examples.md
```

**æ ¸å¿ƒåŠŸèƒ½**:
- å•å…ƒæµ‹è¯• (pytest)
- Mock API å“åº”
- ä½¿ç”¨ç¤ºä¾‹
- API æ–‡æ¡£

## å¼€å‘ä¼˜å…ˆçº§

### ğŸš€ Phase 1: MVP (æœ€å°å¯ç”¨ç‰ˆæœ¬)
1. **Task 1**: åŸºç¡€æ¶æ„
2. **Task 2**: æ•°æ®æ¨¡å‹
3. **Task 3**: èµ„æºç®¡ç†å™¨
4. **Task 4**: åŒæ­¥å®¢æˆ·ç«¯

**ç›®æ ‡**: æ›¿æ¢ç°æœ‰ manage_groups.pyï¼Œæä¾›æ›´å¥½çš„ API

### ğŸ“ˆ Phase 2: åŠŸèƒ½å®Œå–„
5. **Task 5**: CLI å·¥å…·
6. **Task 6**: æµ‹è¯•å’Œæ–‡æ¡£

**ç›®æ ‡**: æä¾›å®Œæ•´çš„ç”¨æˆ·ä½“éªŒ

### âš¡ Phase 3: é«˜çº§ç‰¹æ€§
- å¼‚æ­¥å®¢æˆ·ç«¯
- ç¼“å­˜æœºåˆ¶
- é‡è¯•ç­–ç•¥
- WebSocket æ”¯æŒ

## ä»£ç è¿ç§»ç­–ç•¥

### ä» manage_groups.py è¿ç§»çš„ä»£ç 
```python
# ç°æœ‰ä»£ç ä¸­å¯é‡ç”¨çš„éƒ¨åˆ†:
1. API ç«¯ç‚¹å®šä¹‰
2. è®¤è¯é€»è¾‘ (Token æ ¼å¼)
3. é”™è¯¯å¤„ç†é€»è¾‘
4. æ•°æ®è§£æä»£ç 
5. CLI å‚æ•°å®šä¹‰
```

### é‡æ„è¦ç‚¹
```python
# Before (manage_groups.py)
class NetBirdManager:
    def list_peers(self):
        response = self._make_request("GET", "/peers")
        # ç›´æ¥æ‰“å°ï¼Œéš¾ä»¥å¤ç”¨

# After (pynetbird)
class PeersManager:
    def list(self) -> List[Peer]:
        response = self._client.get("/peers")
        return [Peer.model_validate(peer) for peer in response]
        # è¿”å›ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºå¤ç”¨
```

## è´¨é‡ä¿è¯

### ä»£ç æ ‡å‡†
- Type hints è¦†ç›–ç‡ > 90%
- Docstring è¦†ç›–ç‡ 100%
- æµ‹è¯•è¦†ç›–ç‡ > 85%
- Black ä»£ç æ ¼å¼åŒ–
- isort å¯¼å…¥æ’åº

### æµ‹è¯•ç­–ç•¥
```python
# 1. å•å…ƒæµ‹è¯• - Mock API å“åº”
@pytest.fixture
def mock_netbird_api():
    with responses.RequestsMock() as rsps:
        yield rsps

# 2. é›†æˆæµ‹è¯• - çœŸå® API (å¯é€‰)
@pytest.mark.integration
def test_real_api():
    pass

# 3. CLI æµ‹è¯• - Click testing
def test_cli_command():
    result = runner.invoke(cli, ['peers', 'list'])
    assert result.exit_code == 0
```

## Session åˆ†å·¥å»ºè®®

### Session A: æ ¸å¿ƒåŸºç¡€ (æ¨èå…ˆåš)
- Task 1: åŸºç¡€æ¶æ„
- Task 2: æ•°æ®æ¨¡å‹

### Session B: ä¸šåŠ¡é€»è¾‘
- Task 3: èµ„æºç®¡ç†å™¨
- Task 4: å®¢æˆ·ç«¯å°è£…

### Session C: ç”¨æˆ·ç•Œé¢
- Task 5: CLI å·¥å…·
- Task 6: æµ‹è¯•æ–‡æ¡£

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **é€‰æ‹©ä¸€ä¸ª Task å¼€å§‹** (å»ºè®®ä» Task 1 å¼€å§‹)
2. **åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶ç»“æ„**
3. **å®ç°æ ¸å¿ƒåŠŸèƒ½**
4. **ç¼–å†™ç®€å•æµ‹è¯•éªŒè¯**
5. **æäº¤ä»£ç å¹¶è®°å½•è¿›åº¦**

ä½ æƒ³ä»å“ªä¸ª Task å¼€å§‹ï¼Ÿæˆ‘å»ºè®®ä» Task 1 (åŸºç¡€æ¶æ„) å¼€å§‹ï¼Œå› ä¸ºå…¶ä»–æ¨¡å—éƒ½ä¼šä¾èµ–å®ƒã€‚